<div class="row">
  <form id="item" name="item" style="display: block;">
    <div class="large-8 columns">
      商品名:
      <input name="name" type="text">
    </div>
    <div class="large-8 columns">
      説明:
      <textarea name="description"></textarea>
    </div>
    <div class="large-8 columns">
      価格:
      <input name="price" type="number">
    </div>
    <div class="large-8 columns">
      商品画像:
      <input name="images[]" type="file" accept="image/*" multiple>
    </div>
    <div class="large-8 columns">
      <a id="registerItem" href="#" class="small button">登録</a>
    </div>
  </form>
  <script type="application/javascript">
    $(function() {
      $("#registerItem").on("click", function(){
        var form = $("#item");
        var formData = new FormData();
        var item = {
          name: form.find("[name=name]").val(),
          description: form.find("[name=description]").val(),
          price: form.find("[name=price]").val()
        };
        formData.append("item", item);
        $.map( $(":file").get(0).files, function(image, idx){
          formData.append("images["+idx+"]", image);
        })
        $.ajax({
          async: true,
          xhr : function(){
            var XHR = $.ajaxSettings.xhr();
            if(XHR.upload){
              XHR.upload.addEventListener('progress',function(e){
                var progre = parseInt(e.loaded/e.total*10000)/100 ;
                console.log(progre+"%") ;
                $("#progress_bar").width(parseInt(progre/100*300*100)/100+"px");
                $("#progress_bar").height("30px");
                $("#progress_bar").html(progre+"%");
              }, false);
            }
            return XHR;
          },
          url: "/manage/item/",
          type: "post",
          data: formData,
          contentType: "multipart/form-data",
          processData: false
        }).done(function( msg ) {
          console.log( msg );
          $("#output").append(msg);
        });
      });
    });
  </script>
</div>
